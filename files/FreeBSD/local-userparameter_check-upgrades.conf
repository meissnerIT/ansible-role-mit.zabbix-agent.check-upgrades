# Managed by ansible (mit.zabbix-agent.check-upgrades)
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

# We only need to escape the parameters from "$2" to "$$2" if the command has a 'flexible user parameter', e.g. [*]
UserParameter=system.sw.needrestart.kernel,/opt/bin/needrestart | awk ' /NEEDRESTART-KSTA:/ { print $2; }'

UserParameter=system.sw.upgradeable-packages.discover-jail-bases,PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin /opt/bin/zabbix-lld-jail-bases

UserParameter=system.sw.upgradeable-packages.packages,/usr/local/bin/sudo freebsd-update --not-running-from-cron updatesready | egrep -v "(skipped|No updates are available to install\.)"
UserParameter=system.sw.upgradeable-packages.packages-with-base[*],/usr/local/bin/sudo freebsd-update --not-running-from-cron -b $1 --currently-running $2 updatesready | egrep -v "(skipped|No updates are available to install\.)"
UserParameter=system.sw.upgradeable-packages.last_update,stat -f %m /var/db/freebsd-update

UserParameter=system.sw.upgradeable-packages.discover-no-agent-jails,/opt/bin/zabbix-lld-no-agent-jails
# system.sw.upgradeable-packages.pkgs,pkg moved to cron / zabbix trapper

# Audit - See /usr/local/etc/periodic/security/405.pkg-base-audit
UserParameter=system.sw.upgradeable-packages.pkg-audit-kernel,chmod 644 /var/cache/zabbix/pkg-audit; pkg audit --fetch --file /var/cache/zabbix/pkg-audit --raw=json --recursive --quiet $(freebsd-version -k|sed 's,^,FreeBSD-kernel-,;s,-RELEASE-p,_,;s,-RELEASE$,,')
UserParameter=system.sw.upgradeable-packages.pkg-audit,chmod 644 /var/cache/zabbix/pkg-audit; pkg audit --fetch --file /var/cache/zabbix/pkg-audit --raw=json --recursive --quiet
