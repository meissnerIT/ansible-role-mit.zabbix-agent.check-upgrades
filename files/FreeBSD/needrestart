#!/bin/sh
#
# Managed by ansible (mit.zabbix-agent.check-upgrades)
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
#
# Checks if the system needs to be rebootet. Return values are used from
# https://github.com/liske/needrestart/blob/master/README.batch.md
# 
#    0: unknown or failed to detect
#    1: no pending upgrade
#    2: ABI compatible upgrade pending
#    3: version upgrade pending

# sh has no process substitution
tmpfile1="$(mktemp)"
tmpfile2="$(mktemp)"

uname -r > $tmpfile1
freebsd-version -k > $tmpfile2

if diff $tmpfile1 $tmpfile2 1>/dev/null; then
    echo "NEEDRESTART-KSTA: 1"
else
    echo "NEEDRESTART-KSTA: 3"
fi

rm $tmpfile1 $tmpfile2
