#!/bin/sh
#
# Managed by ansible (mit.zabbix-agent.check-upgrades)
# DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
#
# 2024-02-09: Beautified output
# 2024-11-06: Added parameter -v (verbose)

LIBS=$(sudo /usr/local/bin/checkrestart|awk '! /COMMAND/ { print $4; }'|sort -u| tr "\n" ","|sed 's/,$//')

# -v: verbose
if [ "$1" == "-v" ]; then
    echo "Transmitting system.sw.needrestart.library='$LIBS'"
    zabbix_sender -c /usr/local/etc/zabbix64/zabbix_agentd.conf -k "system.sw.needrestart.library" -o "$LIBS"
else
    zabbix_sender -c /usr/local/etc/zabbix64/zabbix_agentd.conf -k "system.sw.needrestart.library" -o "$LIBS" 1>/dev/null
fi
